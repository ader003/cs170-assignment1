1. Hash repeated states
2. increment g_n
3. 